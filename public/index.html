<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ProactifSystem ‚Äî IA sur mesure</title>

  <!-- ‚úÖ Favicon universel -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">

  <!-- ‚úÖ Apple / iOS -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">

  <!-- ‚úÖ Android / PWA -->
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">

  <!-- ‚úÖ Manifest + couleur de th√®me -->
  <link rel="manifest" href="/site.webmanifest">
  <meta name="theme-color" content="#2563eb">

  <!-- Fonts & styles -->
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="/chatbot.css" />
</head>

<body>
  <header class="hero">
    <nav class="nav">
      <div class="brand">ProactifSystem</div>
      <div class="links">
        <a href="#solutions">Solutions</a>
        <a href="#contact">Contact</a>
        <button id="faq-menu-btn" class="faq-link">‚ùì FAQ</button>
      </div>
    </nav>
    <div class="hero-inner">
      <h1>L'IA au service de votre productivit√©</h1>
      <p>Automatisation intelligente, <strong>analyse de graphiques IA</strong>, chatbots et dashboards.</p>
      <div class="cta">
        <a class="btn" id="open-agent" href="#">Parler √† l'agent</a>
      </div>
    </div>
  </header>

  <main>
    <section id="solutions" class="bento">
      <article class="card">
        <h3>Applications & Logiciels sur mesure</h3>
        <p>Outils web, scripts, int√©grations API, automatisations adapt√©es √† votre m√©tier.</p>
      </article>
      <article class="card">
        <h3>Automatisation IA</h3>
        <p>Emails, CRM, reporting, workflows sans t√¢ches r√©p√©titives.</p>
      </article>
      <article class="card">
        <h3>Analyse de donn√©es & Dashboards</h3>
        <p>KPIs, rapports visuels, d√©cision assist√©e par l'IA.</p>
      </article>
      <article class="card">
        <h3>Chatbots & Agents</h3>
        <p>Support, qualification, collecte de leads, FAQ intelligente.</p>
      </article>
    </section>

    <section id="contact" class="contact">
      <h2>Laissez-nous vos informations de contact pour qu'on puisse √©changer sur vos besoins.</h2>

      <form id="lead-form" class="form" autocomplete="on">
        <input name="name" type="text" placeholder="Votre nom" autocomplete="name" required />
        <input name="company" type="text" placeholder="Nom de votre entreprise" autocomplete="organization" />
        <input name="email" type="email" placeholder="Votre e-mail" autocomplete="email" required />
        <label for="phone">Num√©ro de t√©l√©phone (avec indicatif)</label>
        <input id="phone" name="phone" type="tel" placeholder="+33 6 12 34 56 78" autocomplete="tel" required />

        <textarea name="message" rows="5" placeholder="D√©crivez votre besoin" autocomplete="off"></textarea>

        <button class="btn" type="submit">Envoyer</button>
        <p id="lead-status" class="status" aria-live="polite"></p>
      </form>
    </section>
  </main>

  <footer class="footer">
    <p>¬© 2025 ProactifSyst√®me ‚Äî IA sur mesure</p>
    <button id="legal-toggle" class="legal-btn">Mentions l√©gales & Confidentialit√©</button>

    <div id="legal-panel" class="legal-panel" style="display:none;">
      <h3>Mentions l√©gales</h3>
      <p><strong>√âditeur :</strong> ProactifSyst√®me, g√©r√©e par Didier Sellin.</p>
      <p><strong>Email :</strong> contact@proactifsysteme.fr</p>
      <p><strong>H√©bergement :</strong> Serveur priv√© (Node.js / Express).</p>

      <h3>Politique de confidentialit√©</h3>
      <p>Les donn√©es collect√©es via ce site (nom, email, t√©l√©phone, message) sont utilis√©es uniquement
        pour r√©pondre √† vos demandes et ne sont jamais partag√©es avec des tiers.</p>
      <p>Vos donn√©es personnelles seront conserv√©es pendant une dur√©e d'un an √† compter de leur collecte. Au-del√†
        de cette p√©riode, elles seront supprim√©es ou anonymis√©es conform√©ment √† nos engagements en mati√®re de protection
        des donn√©es.</p>
      <p>Vous pouvez demander la suppression de vos donn√©es en √©crivant √†
        <a href="mailto:contact@proactifsysteme.fr">contact@proactifsysteme.fr</a>.
      </p>

      <p>Ce site utilise Google reCAPTCHA pour se prot√©ger contre le spam.
        <a href="https://policies.google.com/privacy" target="_blank" rel="noopener">Politique de confidentialit√©</a>
        et <a href="https://policies.google.com/terms" target="_blank" rel="noopener">Conditions d'utilisation</a> de
        Google s'appliquent.
      </p>

      <button id="legal-close" class="legal-btn-close">Fermer</button>
    </div>
  </footer>

  <!-- ‚úÖ Chatbot -->
  <div id="agent-widget" aria-live="polite">
    <div class="bubble">Je suis l√† pour vous aider !</div>
    <button id="agent-toggle" aria-label="Ouvrir le chat">ü§ñ</button>

    <div id="agent-panel">
      <div id="agent-header">
        <strong>Agent ProactifSyst√®me</strong>
        <div id="agent-controls">
          <button id="agent-minimize" type="button" title="R√©duire" aria-label="R√©duire">‚Äî</button>
          <button id="agent-expand" type="button" title="Agrandir" aria-label="Agrandir">‚§¢</button>
          <button id="agent-close" type="button" title="Fermer" aria-label="Fermer">‚úï</button>
        </div>
      </div>

      <div id="agent-log"></div>

      <div id="agent-toolbar">
        <button id="agent-clear" title="Effacer l'historique">üóëÔ∏è</button>
        <button id="faq-open" title="Questions fr√©quentes">üìã FAQ</button>
      </div>

      <form id="agent-form" autocomplete="off">
        <input id="agent-input" type="text" placeholder="Posez votre question‚Ä¶" />
        <button id="agent-mic" type="button" title="Parler">üé§</button>
        <button type="submit">Envoyer</button>
      </form>
    </div>
  </div>

  <!-- ‚úÖ Scripts -->
  <script src="/js/config.js" defer></script>
  <script src="/js/agent.js?v=10"></script>

  <!-- ‚úÖ Script Mentions l√©gales -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const toggleBtn = document.getElementById("legal-toggle");
      const legalPanel = document.getElementById("legal-panel");
      const closeBtn = document.getElementById("legal-close");

      if (!toggleBtn || !legalPanel) return;

      toggleBtn.addEventListener("click", () => {
        const isVisible = legalPanel.style.display === "block";
        legalPanel.style.display = isVisible ? "none" : "block";
        if (!isVisible) {
          legalPanel.scrollIntoView({ behavior: "smooth", block: "center" });
        }
      });

      closeBtn?.addEventListener("click", () => {
        legalPanel.style.display = "none";
      });

      document.addEventListener("click", (e) => {
        if (
          legalPanel.style.display === "block" &&
          !legalPanel.contains(e.target) &&
          e.target !== toggleBtn
        ) {
          legalPanel.style.display = "none";
        }
      });
    });
  </script>

  <!-- ‚úÖ Chargement dynamique reCAPTCHA + gestion formulaire -->
  <script>
    // Charge la cl√© reCAPTCHA depuis le serveur
    fetch('/api/config')
      .then(r => r.json())
      .then(config => {
        const script = document.createElement('script');
        script.src = `https://www.google.com/recaptcha/api.js?render=${config.recaptchaSiteKey}`;
        document.head.appendChild(script);
        window.RECAPTCHA_KEY = config.recaptchaSiteKey;
      })
      .catch(err => {
        console.error('Erreur config reCAPTCHA:', err);
        // Fallback si /api/config √©choue
        window.RECAPTCHA_KEY = '6LeAVAksAAAAAJCJqveZyvOWyJ12B3dhPexH2y5G';
        const script = document.createElement('script');
        script.src = `https://www.google.com/recaptcha/api.js?render=${window.RECAPTCHA_KEY}`;
        document.head.appendChild(script);
      });

    // Gestion soumission formulaire
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('lead-form');
      const status = document.getElementById('lead-status');

      if (!form) return;

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Validation c√¥t√© client
        const nameInput = form.querySelector('input[name="name"]');
        const emailInput = form.querySelector('input[name="email"]');
        const phoneInput = form.querySelector('input[name="phone"]');

        if (!nameInput.value.trim()) {
          alert('‚ùå Veuillez entrer votre nom.');
          nameInput.focus();
          return;
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(emailInput.value)) {
          alert('‚ùå Adresse e-mail invalide.');
          emailInput.focus();
          return;
        }

        const phoneRegex = /^(\+?\d{1,3}[- ]?)?\d{6,14}$/;
        if (phoneInput.value && !phoneRegex.test(phoneInput.value.replace(/\s+/g, ''))) {
          alert('‚ùå Num√©ro de t√©l√©phone invalide.\nFormat : +33 6 12 34 56 78');
          phoneInput.focus();
          return;
        }

        // Affiche loader
        if (status) {
          status.textContent = '‚è≥ Envoi en cours...';
          status.style.color = '#ffaa00';
        }

        // V√©rifie que reCAPTCHA est charg√©
        if (typeof grecaptcha === 'undefined' || !window.RECAPTCHA_KEY) {
          if (status) {
            status.textContent = '‚ö†Ô∏è reCAPTCHA non charg√©. R√©essayez.';
            status.style.color = '#ff4444';
          }
          return;
        }

        try {
          await grecaptcha.ready(async () => {
            const token = await grecaptcha.execute(window.RECAPTCHA_KEY, { action: 'submit' });

            const data = Object.fromEntries(new FormData(form).entries());
            data.token = token;

            const res = await fetch('/api/lead', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify(data)
            });

            const result = await res.json();

            if (status) {
              status.textContent = result.message || (result.ok ? '‚úÖ Message envoy√© !' : '‚ùå Erreur');
              status.style.color = result.ok ? '#00cc66' : '#ff4444';
            }

            if (result.ok) {
              form.reset();
              alert('‚úÖ Votre message a bien √©t√© envoy√©.\nNous vous r√©pondrons sous 24h.');
            } else {
              alert('‚ö†Ô∏è ' + (result.message || 'Une erreur est survenue.'));
            }
          });
        } catch (err) {
          console.error('Erreur formulaire:', err);
          if (status) {
            status.textContent = '‚ùå Erreur r√©seau.';
            status.style.color = '#ff4444';
          }
          alert('‚ùå Impossible de contacter le serveur.');
        }
      });
    });
  </script>
</body>

</html>